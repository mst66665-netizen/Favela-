<div class="home-wrapper">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        .home-wrapper {
            animation: fadeIn 0.6s ease-out;
            padding: 15px;
            direction: rtl;
            background: #f8f9fc;
            min-height: 100vh;
        }

        /* --- Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø­ÙØ¸Ø© (Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ù…Ù„ÙƒÙŠ) --- */
        .wallet-card {
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            border-radius: 28px;
            padding: 25px;
            color: white;
            box-shadow: 0 12px 30px rgba(48, 43, 99, 0.4);
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.08);
        }

        .main-label {
            font-size: 0.85rem;
            opacity: 0.7;
            display: block;
            margin-bottom: 10px;
            letter-spacing: 0.5px;
        }

        .total-amount-box {
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .total-amount-box h2 {
            font-size: 2.6rem;
            font-weight: 900;
            margin: 0;
            color: #ffffff;
            letter-spacing: -1px;
        }

        .total-amount-box .usdt-tag {
            font-size: 1rem;
            color: #f1c40f;
            font-weight: 800;
            background: rgba(241, 196, 15, 0.1);
            padding: 4px 10px;
            border-radius: 8px;
        }

        /* ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£Ø±ØµØ¯Ø© */
        .sub-balances {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            border-top: 1px solid rgba(255,255,255,0.12);
            padding-top: 20px;
        }

        .sub-item {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .sub-item label {
            font-size: 0.75rem;
            opacity: 0.6;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .sub-item .value-container {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .sub-item .value-text {
            font-size: 1.15rem;
            font-weight: 800;
            color: #fff;
        }

        .unit-small {
            font-size: 0.7rem;
            color: #2ecc71;
            font-weight: 600;
        }

        /* --- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª --- */
        .actions-grid {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .btn-action {
            flex: 1;
            background: white;
            border-radius: 22px;
            padding: 18px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.04);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .icon-box {
            width: 55px;
            height: 55px;
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            transition: 0.3s;
        }

        .bg-deposit {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
            box-shadow: 0 6px 15px rgba(0, 176, 155, 0.3);
        }

        .bg-withdraw {
            background: linear-gradient(135deg, #f83600, #fe8c00);
            color: white;
            box-shadow: 0 6px 15px rgba(248, 54, 0, 0.3);
        }

        .btn-action span {
            font-size: 0.95rem;
            font-weight: 800;
            color: #2c3e50;
        }

        .btn-action:active { transform: scale(0.94); }

        /* --- Ø´Ø±ÙŠØ· Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª --- */
        .quick-stats {
            background: white;
            border-radius: 22px;
            padding: 22px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 5px 20px rgba(0,0,0,0.02);
            border: 1px solid #f0f2f5;
        }

        .stat-node { text-align: center; }
        .stat-node h6 { color: #95a5a6; font-size: 0.75rem; margin-bottom: 6px; font-weight: 600; }
        .stat-node p { color: #2c3e50; font-weight: 800; font-size: 1rem; margin: 0; }

        /* --- ğŸ Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© (Ø§Ù„Ø¬Ø¯ÙŠØ¯) --- */
        .welcome-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.7); backdrop-filter: blur(5px);
            z-index: 9999; display: none; justify-content: center; align-items: center;
            animation: fadeIn 0.4s ease;
        }
        .welcome-box {
            background: white; width: 85%; max-width: 350px;
            padding: 30px 20px; border-radius: 30px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            position: relative;
            transform: scale(0.8); animation: popUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        .gift-icon {
            font-size: 4rem; margin-bottom: 15px; display: inline-block;
            animation: bounce 2s infinite;
        }
        .welcome-title { font-size: 1.4rem; font-weight: 900; color: #2c3e50; margin-bottom: 10px; }
        .welcome-text { font-size: 0.95rem; color: #7f8c8d; line-height: 1.6; margin-bottom: 25px; font-weight: 600; }
        .claim-btn {
            background: linear-gradient(135deg, #e1b12c, #fbc531);
            color: #2f3640; border: none; padding: 12px 30px; border-radius: 50px;
            font-size: 1rem; font-weight: 800; cursor: pointer;
            box-shadow: 0 8px 20px rgba(225, 177, 44, 0.4); transition: 0.3s; width: 100%;
        }
        .claim-btn:active { transform: scale(0.95); }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(12px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes popUp { to { transform: scale(1); } }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-15px);} 60% {transform: translateY(-7px);} }
    </style>

    <div class="wallet-card">
        <span class="main-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ© (USDT)</span>
        <div class="total-amount-box">
            <h2 id="total-val">0.00</h2>
            <div class="usdt-tag">USDT</div>
        </div>

        <div class="sub-balances">
            <div class="sub-item">
                <label><i class="fas fa-gem"></i> Ø±ØµÙŠØ¯ Ø§Ù„Ø§Ø³ØªØ«Ù…Ø§Ø±</label>
                <div class="value-container">
                    <span class="value-text" id="invest-val">0.00</span>
                    <span class="unit-small">USDT</span>
                </div>
            </div>
            <div class="sub-item">
                <label><i class="fas fa-coins"></i> Ø±ØµÙŠØ¯ Ø§Ù„Ø£ØµÙˆÙ„</label>
                <div class="value-container">
                    <span class="value-text" id="assets-val">0.00</span>
                    <span class="unit-small">USDT</span>
                </div>
            </div>
        </div>
    </div>

    <div class="actions-grid">
        <div class="btn-action" onclick="window.showTab('deposit-section', 'deposit.html', this)">
            <div class="icon-box bg-deposit">
                <i class="fas fa-layer-group"></i>
            </div>
            <span>ØªØ¹Ø¨Ø¦Ø© Ø±ØµÙŠØ¯</span>
        </div>
        
        <div class="btn-action" onclick="window.showTab('withdraw-section', 'withdraw.html', this)">
            <div class="icon-box bg-withdraw">
                <i class="fas fa-wallet"></i>
            </div>
            <span>Ø³Ø­Ø¨ Ø§Ù„Ø¢Ù†</span>
        </div>
    </div>

    <div class="quick-stats">
        <div class="stat-node">
            <h6>Ø¯Ø®Ù„ Ø§Ù„ÙŠÙˆÙ…</h6>
            <p id="today-income">0.00</p>
        </div>
        <div style="width: 1.5px; background: #f0f2f5;"></div>
        <div class="stat-node">
            <h6>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</h6>
            <p id="vip-level" style="color: #f1c40f;">VIP 0</p>
        </div>
        <div style="width: 1.5px; background: #f0f2f5;"></div>
        <div class="stat-node">
            <h6>Ø¯Ø®Ù„ Ø§Ù„ÙØ±ÙŠÙ‚</h6>
            <p id="team-income">0.00</p>
        </div>
    </div>

    <div id="welcome-modal" class="welcome-overlay">
        <div class="welcome-box">
            <div class="gift-icon">ğŸ</div>
            <h3 class="welcome-title">Ù‡Ø¯ÙŠØ© ØªØ±Ø­ÙŠØ¨ÙŠØ©</h3>
            <p class="welcome-text">
                Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø´Ø±ÙƒØ© Flores Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†ÙŠØ© <br>
                Ù„Ù‚Ø¯ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ Ù‡Ø¯ÙŠØ© ØªØ±Ø­ÙŠØ¨ÙŠØ©: <b>Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¬Ø§Ù†ÙŠØ©</b> ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡Ø§ ÙÙŠ Ø¹Ø¬Ù„Ø© Ø§Ù„Ø­Ø¸! ğŸ¡
                <br><br>
                ØªÙ‚Ø¯Ù… Ù„ÙƒÙ… Ø§Ù„Ø´Ø±ÙƒØ© ÙØ±ØµØ© Ø¹Ù…Ù„ ÙˆØ£Ø±Ø¨Ø§Ø­ ÙŠÙˆÙ…ÙŠØ©.
            </p>
            <button class="claim-btn" onclick="closeWelcome()">Ø§Ø³ØªÙ„Ø§Ù… Ø§Ù„Ù‡Ø¯ÙŠØ©</button>
        </div>
    </div>

    <script type="module">
        import { ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        
        const db = window.parent.firebaseRtdb;
        const auth = window.parent.firebaseAuth;

        function initHome() {
            if (!auth.currentUser) return;
            
            const emailKey = auth.currentUser.email.replace(/\./g, '_');
            const userRef = ref(db, 'users/' + emailKey);

            // 1. Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
            onValue(userRef, (snapshot) => {
                const data = snapshot.val() || {};
                
                const investBal = parseFloat(data.investBalance || 0);
                const assetsBal = parseFloat(data.balance || 0);
                const total = investBal + assetsBal;

                document.getElementById('invest-val').innerText = investBal.toFixed(2);
                document.getElementById('assets-val').innerText = assetsBal.toFixed(2);
                document.getElementById('total-val').innerText = total.toFixed(2);
                
                document.getElementById('vip-level').innerText = data.vipLevel || "VIP 0";
                document.getElementById('today-income').innerText = (data.todayIncome || 0).toFixed(2);
                document.getElementById('team-income').innerText = (data.teamIncome || 0).toFixed(2);

                // 2. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠØ© (ØªØ¸Ù‡Ø± Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·)
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¯ Ø¶ØºØ· Ø§Ø³ØªÙ„Ø§Ù… Ù…Ù† Ù‚Ø¨Ù„
                if (!data.welcomeSeen) {
                    setTimeout(() => {
                        const modal = document.getElementById('welcome-modal');
                        if(modal) modal.style.display = 'flex';
                    }, 1500); // ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ© ÙˆÙ†ØµÙ
                }
            });
        }

        // Ø¯Ø§Ù„Ø© Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© ÙˆØ­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø©
        window.closeWelcome = async function() {
            if (!auth.currentUser) return;
            const emailKey = auth.currentUser.email.replace(/\./g, '_');
            const userRef = ref(db, 'users/' + emailKey);

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Ø§ÙØ°Ø©
            document.getElementById('welcome-modal').style.display = 'none';

            // ØªØ³Ø¬ÙŠÙ„ Ø£Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ø³ØªÙ„Ù… Ø§Ù„Ù‡Ø¯ÙŠØ© ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
            await update(userRef, {
                welcomeSeen: true
            });
        };

        // ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¯Ø§Ù„Ø©
        initHome();
    </script>
</div>
